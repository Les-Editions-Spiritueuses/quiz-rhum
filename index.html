<!DOCTYPE html>
<html lang="fr">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Quiz Rhum - Connaisseur</title>
Â  Â  <style>
Â  Â  Â  Â  /* Couleurs et ThÃ¨me Rhum */
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --primary: #d35400; /* Rhum AmbrÃ© */
Â  Â  Â  Â  Â  Â  --secondary: #fdf2e9; /* Fond Clair */
Â  Â  Â  Â  Â  Â  --dark: #2c3e50;
Â  Â  Â  Â  Â  Â  --correct: #27ae60;
Â  Â  Â  Â  Â  Â  --wrong: #c0392b;
Â  Â  Â  Â  Â  Â  --barrel-brown: #8b4513;
Â  Â  Â  Â  Â  Â  --barrel-highlight: #a0522d;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* 1. Visuel Global */
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
Â  Â  Â  Â  Â  Â  color: var(--dark);
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  min-height: 100vh;
Â  Â  Â  Â  Â  Â  background-color: #f4f6f7;
Â  Â  Â  Â  }

Â  Â  Â  Â  .quiz-container {
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  max-width: 600px;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 15px 35px rgba(0,0,0,0.2);
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  padding: 30px;
Â  Â  Â  Â  Â  Â  transition: all 0.3s ease-in-out;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* 2. Styles de la Page d'Accueil */
Â  Â  Â  Â  #welcome-area {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  .welcome-title {
Â  Â  Â  Â  Â  Â  color: var(--primary);
Â  Â  Â  Â  Â  Â  font-size: 2.5em;
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  Â  Â  border-bottom: 3px solid var(--primary);
Â  Â  Â  Â  Â  Â  display: inline-block;
Â  Â  Â  Â  Â  Â  padding-bottom: 5px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Style pour l'image de distillerie */
Â  Â  Â  Â  .distillery-image {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  max-height: 250px;
Â  Â  Â  Â  Â  Â  object-fit: cover;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  margin: 20px 0;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  }

Â  Â  Â  Â  .welcome-description {
Â  Â  Â  Â  Â  Â  font-size: 1.1em;
Â  Â  Â  Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  Â  Â  Â  line-height: 1.6;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Styles du Quiz */
Â  Â  Â  Â  .header {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  border-bottom: 2px solid var(--secondary);
Â  Â  Â  Â  Â  Â  padding-bottom: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .header h1 { margin: 0; color: var(--dark); font-size: 1.5em;}
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Conteneur de la progression (Question # et Chrono) */
Â  Â  Â  Â  .progress-bar-container {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  Â  Â  font-size: 1em;Â 
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  color: var(--dark);
Â  Â  Â  Â  }

Â  Â  Â  Â  .question-progress-live { color: var(--primary); }
Â  Â  Â  Â  .chrono-live { color: var(--dark); }


Â  Â  Â  Â  .question-card { margin-bottom: 20px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .question-meta {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  font-size: 0.9em;
Â  Â  Â  Â  Â  Â  color: var(--primary);
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  Â  Â  text-transform: uppercase;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  letter-spacing: 1px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .question-text::before {
Â  Â  Â  Â  Â  Â  content: "ğŸ¥ƒ ";
Â  Â  Â  Â  Â  Â  font-size: 1.2em;
Â  Â  Â  Â  Â  Â  margin-right: 5px;
Â  Â  Â  Â  Â  Â  color: var(--primary);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .question-text {
Â  Â  Â  Â  Â  Â  font-size: 1.2em;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  line-height: 1.5;
Â  Â  Â  Â  Â  Â  padding-left: 5px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .options-grid {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .option-btn {
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  border: 2px solid #bdc3c7;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-size: 1em;
Â  Â  Â  Â  Â  Â  text-align: left;
Â  Â  Â  Â  Â  Â  transition: all 0.2s;
Â  Â  Â  Â  }

Â  Â  Â  Â  .option-btn:hover:not(:disabled) {
Â  Â  Â  Â  Â  Â  border-color: var(--primary);
Â  Â  Â  Â  Â  Â  background-color: var(--secondary);
Â  Â  Â  Â  }

Â  Â  Â  Â  .option-btn.correct {
Â  Â  Â  Â  Â  Â  background-color: #d4efdf;
Â  Â  Â  Â  Â  Â  border-color: var(--correct);
Â  Â  Â  Â  Â  Â  color: var(--correct);
Â  Â  Â  Â  }

Â  Â  Â  Â  .option-btn.wrong {
Â  Â  Â  Â  Â  Â  background-color: #fadbd8;
Â  Â  Â  Â  Â  Â  border-color: var(--wrong);
Â  Â  Â  Â  Â  Â  color: var(--wrong);
Â  Â  Â  Â  }

Â  Â  Â  Â  .feedback {
Â  Â  Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  background-color: #ecf0f1;
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Style pour les boutons gÃ©nÃ©raux */
Â  Â  Â  Â  .action-btn {
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  background-color: var(--primary);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  font-size: 1.1em;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  Â  Â  transition: background-color 0.2s;
Â  Â  Â  Â  }

Â  Â  Â  Â  .action-btn:hover { background-color: #a04000; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Style pour le bouton du Quiz Whisky (action secondaire) */
Â  Â  Â  Â  .other-quiz-btn {
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  padding: 10px; /* Moins haut que le bouton principal */
Â  Â  Â  Â  Â  Â  background-color: transparent; /* Fond transparent */
Â  Â  Â  Â  Â  Â  color: var(--dark); /* Texte sombre */
Â  Â  Â  Â  Â  Â  border: 1px solid var(--dark); /* Bordure sombre */
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  font-size: 1em;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  margin-top: 15px; /* SÃ©paration */
Â  Â  Â  Â  Â  Â  text-decoration: none; /* EnlÃ¨ve le soulignement du lien */
Â  Â  Â  Â  Â  Â  transition: all 0.2s;
Â  Â  Â  Â  }

Â  Â  Â  Â  .other-quiz-btn:hover {
Â  Â  Â  Â  Â  Â  background-color: var(--dark);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  .results-card {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .final-score {
Â  Â  Â  Â  Â  Â  font-size: 3em;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  color: var(--primary);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Style pour le bouton d'envoi des rÃ©sultats */
Â  Â  Â  Â  #send-results-btn {
Â  Â  Â  Â  Â  Â  margin-top: 15px;
Â  Â  Â  Â  Â  Â  background-color: var(--correct);
Â  Â  Â  Â  Â  Â  border-color: var(--correct);
Â  Â  Â  Â  }
Â  Â  Â  Â  #send-results-btn:hover {
Â  Â  Â  Â  Â  Â  background-color: #229954;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>

<div class="quiz-container">
Â  Â Â 
Â  Â  <div id="welcome-area">
Â  Â  Â  Â  <h1 class="welcome-title">Quiz Rhum</h1>
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <img id="distillery-image-placeholder" class="distillery-image" alt="Illustration de distillerie de rhum et canne Ã  sucre">
Â  Â  Â  Â Â 
Â  Â  Â  Â  <p class="welcome-description">
Â  Â  Â  Â  Â  Â  Avec Les Editions Spiritueuses, testez vos connaissances sur le rhum ! : Plongez dans son univers fascinant et dÃ©couvrez si vous Ãªtes un vÃ©ritable connaisseur de ce spiritueux lÃ©gendaire !
Â  Â  Â  Â  </p>
Â  Â  Â  Â  <p style="font-weight: bold; color: #CC7722; border: 1px dashed #CC7722; padding: 10px; margin-top: 20px;">
Â  Â  Â  Â  âš ï¸ RÃˆGLE DE SCORING : Le score final est pondÃ©rÃ© par le temps de rÃ©ponse. Le temps cible est de **2 minutes (120 secondes)**. Si vous dÃ©passez 2 minutes, votre Index de Performance sera lÃ©gÃ¨rement pÃ©nalisÃ©.
Â  Â  </p>
Â  Â  Â  Â  <button class="action-btn" onclick="startQuiz()">Commencer le Quiz</button>
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <a href="https://les-editions-spiritueuses.github.io/quiz-whisky/" target="_blank" class="other-quiz-btn">
Â  Â  Â  Â  Â  Â  Testez votre connaissance sur le whisky
Â  Â  Â  Â  </a>
Â  Â  </div>

Â  Â  <div id="quiz-area" style="display:none;">
Â  Â  Â  Â  <div class="header">
Â  Â  Â  Â  Â  Â  <h1>Connaisseur du Rhum</h1>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="progress-bar-container">
Â  Â  Â  Â  Â  Â  Â  Â  <span id="question-progress-live" class="question-progress-live">Question 0 / 15</span>Â 
Â  Â  Â  Â  Â  Â  Â  Â  <span id="chrono-live" class="chrono-live">00:00</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="question-card">
Â  Â  Â  Â  Â  Â  <div class="question-meta">
Â  Â  Â  Â  Â  Â  Â  Â  <span id="q-difficulty">DifficultÃ©</span>
Â  Â  Â  Â  Â  Â  Â  Â  <span id="q-points">Points</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="question-text" id="question-text"></div>
Â  Â  Â  Â  Â  Â  <div class="options-grid" id="options-container">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="feedback" id="feedback-area"></div>
Â  Â  Â  Â  <button class="action-btn" id="next-btn" style="display:none" onclick="nextQuestion()">Question Suivante</button>
Â  Â  </div>

Â  Â  <div class="results-card" id="results-area" style="display:none;">
Â  Â  Â  Â  <h2>Quiz TerminÃ© !</h2>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <p style="font-size: 1.2em; color: var(--primary); font-weight: bold;">
Â  Â  Â  Â  Â  Â  Pour voir les rÃ©sultats, renseignez votre pseudo :
Â  Â  Â  Â  </p>

Â  Â  Â  Â  <input type="text" id="pseudo-input" placeholder="Votre Pseudo (requis)"Â 
Â  Â  Â  Â  Â  Â  style="padding: 10px; width: 80%; margin-top: 15px; border: 1px solid #ccc; border-radius: 5px;"
Â  Â  Â  Â  Â  Â  oninput="handlePseudoInput(this.value)">Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <button class="action-btn" id="send-results-btn" style="display:none;" onclick="sendResultFromButton()">
Â  Â  Â  Â  Â  Â  Enregistrer mon rÃ©sultat
Â  Â  Â  Â  </button>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="final-results-display" style="display:none;">
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="raw-score-display" style="font-size: 1.2em; font-weight: bold; margin-bottom: 5px; color: var(--dark);"></p>

Â  Â  Â  Â  Â  Â  <p id="time-taken-display" style="font-weight: bold; margin-bottom: 20px; color: var(--barrel-brown);"></p>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <p>Votre **Index de Performance** est de :</p>
Â  Â  Â  Â  Â  Â  <div class="final-score"><span id="final-score-val">0%</span></div>

Â  Â  Â  Â  Â  Â  <p id="final-message"></p>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <p id="send-status" style="font-weight: bold; color: var(--correct); margin-top: 10px;"></p>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <button class="action-btn" style="background-color: #34495e;" onclick="location.reload()">Recommencer</button>
Â  Â  </div>


<script>
Â  Â  // -------------------------------------------------------------------
Â  Â  // URL BRUTE (RAW) DE L'IMAGE GITHUB CORRIGÃ‰E
Â  Â  // -------------------------------------------------------------------
Â  Â  const DISTILLERY_IMAGE_URL = "https://raw.githubusercontent.com/Les-Editions-Spiritueuses/quiz-rhum/main/distillerie-canne.jpg";Â 

Â  Â  // VOTRE URL DE DEPLOIEMENT GOOGLE APPS SCRIPT
Â  Â  // REMPLACER cette chaÃ®ne par votre propre URL de dÃ©ploiement Google Apps Script !
Â  Â  const GAS_URL = "https://script.google.com/macros/s/AKfycbyKCoo68vq5DbX4v2vlSLGGkKigeDWeoEF3dMOxwP7tllx5MPADuSzvLxpOeMGM1PNB4Q/exec";

Â  Â  let resultSent = false;Â 
Â  Â  let chronoInterval; // Pour stocker l'intervalle du chronomÃ¨tre
Â  Â Â 
Â  Â  // DonnÃ©es du Quiz
Â  Â  const quizData = [
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  q: "Quel Ã©lÃ©ment diffÃ©rencie le plus clairement un rhum agricole dâ€™un rhum traditionnel ?",
Â  Â  Â  Â  Â  Â  options: ["Le type de fÃ»ts utilisÃ©s", "Le climat de la distillerie", "La matiÃ¨re premiÃ¨re : vesou ou mÃ©lasse"],
Â  Â  Â  Â  Â  Â  correct: 2,
Â  Â  Â  Â  Â  Â  points: 1,
Â  Â  Â  Â  Â  Â  explanation: "Le rhum agricole est fait Ã  partir de pur jus de canne (vesou), le traditionnel Ã  partir de mÃ©lasse."
Â  Â  Â  Â  },
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  q: "Le vesou est :",
Â  Â  Â  Â  Â  Â  options: ["Le jus de canne Ã  sucre frais pressÃ©", "Un sirop de canne concentrÃ©", "Un distillat de mÃ©lasse"],
Â  Â  Â  Â  Â  Â  correct: 0,
Â  Â  Â  Â  Â  Â  points: 2,
Â  Â  Â  Â  Â  Â  explanation: "Le vesou est le terme technique dÃ©signant le jus extrait directement du broyage de la canne."
Â  Â  Â  Â  },
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  q: "La mÃ©lasse donne souvent des rhums :",
Â  Â  Â  Â  Â  Â  options: ["Neutres et peu aromatiques", "Plus ronds, parfois gourmands", "LÃ©gers et floraux sans exception"],
Â  Â  Â  Â  Â  Â  correct: 1,
Â  Â  Â  Â  Â  Â  points: 3,
Â  Â  Â  Â  Â  Â  explanation: "La mÃ©lasse, issue du sucre cuit, tend Ã  donner des notes de caramel et une certaine rondeur."
Â  Â  Â  Â  },
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  q: "Quelle est lâ€™une des consÃ©quences dâ€™une fermentation longue ?",
Â  Â  Â  Â  Â  Â  options: ["Favorise les arÃ´mes complexes (fruitÃ©s/fermentaires)", "Donne un rhum trÃ¨s lÃ©ger", "RÃ©duit systÃ©matiquement l'alcool"],
Â  Â  Â  Â  Â  Â  correct: 0,
Â  Â  Â  Â  Â  Â  points: 1,
Â  Â  Â  Â  Â  Â  explanation: "Le temps permet aux levures de crÃ©er des esters complexes et aromatiques."
Â  Â  Â  Â  },
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  q: "Une fermentation courte donne gÃ©nÃ©ralement :",
Â  Â  Â  Â  Â  Â  options: ["Des arÃ´mes lourds et Ã©pais", "Des rhums exclusivement vieillis", "Des rhums plus lÃ©gers et fruitÃ©s"],
Â  Â  Â  Â  Â  Â  correct: 2,
Â  Â  Â  Â  Â  Â  points: 2,
Â  Â  Â  Â  Â  Â  explanation: "Une fermentation rapide limite les congÃ©nÃ¨res lourds pour un rÃ©sultat plus lÃ©ger."
Â  Â  Â  Â  },
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  q: "Une fermentation longue permet surtout :",
Â  Â  Â  Â  Â  Â  options: ["De rÃ©duire le taux dâ€™alcool", "De dÃ©velopper des arÃ´mes complexes, riches en esters", "Dâ€™aromatiser avec des fruits"],
Â  Â  Â  Â  Â  Â  correct: 1,
Â  Â  Â  Â  Â  Â  points: 3,
Â  Â  Â  Â  Â  Â  explanation: "C'est le secret des rhums 'Grand ArÃ´me' ou High Ester."
Â  Â  Â  Â  },
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  q: "La distillation consiste principalement Ã  :",
Â  Â  Â  Â  Â  Â  options: ["Sucrer le rhum", "SÃ©parer lâ€™alcool de lâ€™eau par chauffage", "Embouteiller le distillat"],
Â  Â  Â  Â  Â  Â  correct: 1,
Â  Â  Â  Â  Â  Â  points: 1,
Â  Â  Â  Â  Â  Â  explanation: "C'est un procÃ©dÃ© de sÃ©paration thermique basÃ© sur les points d'Ã©bullition."
Â  Â  Â  Â  },
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  q: "Le pot still est souvent associÃ© Ã  :",
Â  Â  Â  Â  Â  Â  options: ["Une distillation Ã  froid", "Des rhums trÃ¨s neutres", "Un style aromatique riche et puissant"],
Â  Â  Â  Â  Â  Â  correct: 2,
Â  Â  Â  Â  Â  Â  points: 2,
Â  Â  Â  Â  Â  Â  explanation: "L'alambic Ã  repasse conserve plus d'Ã©lÃ©ments lourds et aromatiques que la colonne."
Â  Â  Â  Â  },
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  q: "La distillation en colonne permet gÃ©nÃ©ralement :",
Â  Â  Â  Â  Â  Â  options: ["Une production continue et optimisÃ©e", "Une production artisanale", "Un taux d'alcool faible"],
Â  Â  Â  Â  Â  Â  correct: 0,
Â  Â  Â  Â  Â  Â  points: 3,
Â  Â  Â  Â  Â  Â  explanation: "C'est la mÃ©thode industrielle par excellence pour les grands volumes."
Â  Â  Â  Â  },
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  q: "Quel climat accÃ©lÃ¨re le vieillissement d'un rhum ?",
Â  Â  Â  Â  Â  Â  options: ["Tropical chaud et humide", "Sec et froid", "Alpin"],
Â  Â  Â  Â  Â  Â  correct: 0,
Â  Â  Â  Â  Â  Â  points: 1,
Â  Â  Â  Â  Â  Â  explanation: "La chaleur dilate le bois et accÃ©lÃ¨re les rÃ©actions chimiques."
Â  Â  Â  Â  },
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  q: "Un vieillissement en climat tropical a pour effet :",
Â  Â  Â  Â  Â  Â  options: ["Dâ€™accÃ©lÃ©rer la maturation et les arÃ´mes boisÃ©s", "De neutraliser le bois", "De rÃ©duire l'alcool drastiquement"],
Â  Â  Â  Â  Â  Â  correct: 0,
Â  Â  Â  Â  Â  Â  points: 2,
Â  Â  Â  Â  Â  Â  explanation: "La 'part des anges' est Ã©levÃ©e, concentrant le rhum et extrayant le bois rapidement."
Â  Â  Â  Â  },
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  q: "Un rhum fini en fÃ»t de Pedro XimÃ©nez aura souvent :",
Â  Â  Â  Â  Â  Â  options: ["Un profil sec et tannique", "Une texture saline", "Des notes liquoreuses, raisin sec et caramel"],
Â  Â  Â  Â  Â  Â  correct: 2,
Â  Â  Â  Â  Â  Â  points: 3,
Â  Â  Â  Â  Â  Â  explanation: "Le fÃ»t de ce vin doux lÃ¨gue ses arÃ´mes sucrÃ©s et fruitÃ©s au rhum."
Â  Â  Â  Â  },
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  q: "Quel est lâ€™un des avantages de lâ€™assemblage ?",
Â  Â  Â  Â  Â  Â  options: ["CrÃ©er un produit Ã©quilibrÃ© et complexe", "Augmenter la production sans distiller", "RÃ©duire le sucre"],
Â  Â  Â  Â  Â  Â  correct: 0,
Â  Â  Â  Â  Â  Â  points: 1,
Â  Â  Â  Â  Â  Â  explanation: "L'assemblage permet d'harmoniser les profils et d'assurer la constance."
Â  Â  Â  Â  },
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  q: "Un rhum 'mono-fÃ»t' (Single Cask) :",
Â  Â  Â  Â  Â  Â  options: ["Est un assemblage de 3 cuvÃ©es", "Vient dâ€™un unique fÃ»t", "Est un rhum brut sans distillation"],
Â  Â  Â  Â  Â  Â  correct: 1,
Â  Â  Â  Â  Â  Â  points: 2,
Â  Â  Â  Â  Â  Â  explanation: "Comme son nom l'indique, il provient d'une seule barrique spÃ©cifique."
Â  Â  Â  Â  },
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  q: "La mÃ©thode Solera permet :",
Â  Â  Â  Â  Â  Â  options: ["De produire un monocÃ©page", "De filtrer via la canne", "IntÃ©grer en continu vieux et jeunes rhums"],
Â  Â  Â  Â  Â  Â  correct: 2,
Â  Â  Â  Â  Â  Â  points: 3,
Â  Â  Â  Â  Â  Â  explanation: "C'est un systÃ¨me dynamique de mÃ©lange vertical pour homogÃ©nÃ©iser les Ã¢ges."
Â  Â  Â  Â  }
Â  Â  ];

Â  Â  let currentQuestionIndex = 0;
Â  Â  let score = 0;
Â  Â  const MAX_SCORE = 30; // Score max possible
Â  Â Â 
Â  Â  // Variables de temps
Â  Â  let startTime;
Â  Â  let timeTakenSeconds = 0;
Â  Â  let performanceIndex = 0;Â 

Â  Â  // Ã‰lÃ©ments du DOM
Â  Â  const welcomeArea = document.getElementById("welcome-area");
Â  Â  const quizArea = document.getElementById("quiz-area");
Â  Â  const resultsArea = document.getElementById("results-area");

Â  Â  const questionText = document.getElementById("question-text");
Â  Â  const optionsContainer = document.getElementById("options-container");
Â  Â  const pointsDisplay = document.getElementById("q-points");
Â  Â  const feedbackArea = document.getElementById("feedback-area");
Â  Â  const nextBtn = document.getElementById("next-btn");
Â  Â Â 
Â  Â  // Ã‰lÃ©ments de progression et d'image
Â  Â  const questionProgressLive = document.getElementById("question-progress-live");Â 
Â  Â  const chronoLiveDisplay = document.getElementById("chrono-live");
Â  Â  const sendResultsBtn = document.getElementById("send-results-btn");
Â  Â  const distilleryImage = document.getElementById("distillery-image-placeholder");

Â  Â  // Chargement de l'image de la distillerie au dÃ©marrage
Â  Â  distilleryImage.src = DISTILLERY_IMAGE_URL;
Â  Â  distilleryImage.onerror = function() {
Â  Â  Â  Â  // Fallback si l'image GitHub ne charge pas
Â  Â  Â  Â  this.src = "https://placehold.co/600x250/c0392b/ffffff?text=Erreur+de+chargement+Image+GitHub";
Â  Â  Â  Â  console.error("L'image de la distillerie n'a pas pu Ãªtre chargÃ©e. VÃ©rifiez l'URL brute (Raw) GitHub.");
Â  Â  };


Â  Â  /**
Â  Â  Â * Met Ã  jour le chronomÃ¨tre affichÃ©.
Â  Â  Â */
Â  Â  function updateChrono() {
Â  Â  Â  Â  const currentTime = new Date();
Â  Â  Â  Â  timeTakenSeconds = Math.round((currentTime - startTime) / 1000);Â 
Â  Â  Â  Â  const minutes = String(Math.floor(timeTakenSeconds / 60)).padStart(2, '0');
Â  Â  Â  Â  const seconds = String(timeTakenSeconds % 60).padStart(2, '0');
Â  Â  Â  Â  chronoLiveDisplay.textContent = `${minutes}:${seconds}`;
Â  Â  }

Â  Â  /**
Â  Â  Â * Lance le quiz en cachant la page d'accueil et DÃ‰MARRE LE CHRONOMÃˆTRE.
Â  Â  Â */
Â  Â  function startQuiz() {
Â  Â  Â  Â  welcomeArea.style.display = "none";
Â  Â  Â  Â  quizArea.style.display = "block";
Â  Â  Â  Â  startTime = new Date(); // DÃ©marrage du chronomÃ¨tre
Â  Â  Â  Â  chronoInterval = setInterval(updateChrono, 1000); // Mise Ã  jour toutes les secondes
Â  Â  Â  Â  loadQuestion();
Â  Â  }

Â  Â  function loadQuestion() {
Â  Â  Â  Â  const currentData = quizData[currentQuestionIndex];
Â  Â  Â  Â Â 
Â  Â  Â  Â  questionText.textContent = currentData.q;
Â  Â  Â  Â  pointsDisplay.textContent = currentData.points + (currentData.points > 1 ? " Points" : " Point");
Â  Â  Â  Â Â 
Â  Â  Â  Â  // MISE Ã€ JOUR DU NUMÃ‰RO DE QUESTION
Â  Â  Â  Â  questionProgressLive.textContent = `Question ${currentQuestionIndex + 1} / ${quizData.length}`;
Â  Â  Â  Â Â 
Â  Â  Â  Â  optionsContainer.innerHTML = "";
Â  Â  Â  Â  feedbackArea.style.display = "none";
Â  Â  Â  Â  nextBtn.style.display = "none";

Â  Â  Â  Â  currentData.options.forEach((opt, index) => {
Â  Â  Â  Â  Â  Â  const btn = document.createElement("button");
Â  Â  Â  Â  Â  Â  btn.className = "option-btn";
Â  Â  Â  Â  Â  Â  btn.textContent = opt;
Â  Â  Â  Â  Â  Â  btn.onclick = () => checkAnswer(index, btn);
Â  Â  Â  Â  Â  Â  optionsContainer.appendChild(btn);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  function checkAnswer(selectedIndex, btnElement) {
Â  Â  Â  Â  const currentData = quizData[currentQuestionIndex];
Â  Â  Â  Â  const buttons = optionsContainer.querySelectorAll(".option-btn");
Â  Â  Â  Â Â 
Â  Â  Â  Â  // DÃ©sactiver tous les boutons
Â  Â  Â  Â  buttons.forEach(btn => btn.disabled = true);

Â  Â  Â  Â  if (selectedIndex === currentData.correct) {
Â  Â  Â  Â  Â  Â  btnElement.classList.add("correct");
Â  Â  Â  Â  Â  Â  score += currentData.points;
Â  Â  Â  Â  Â  Â  feedbackArea.innerHTML = `<strong>Correct !</strong> <br>${currentData.explanation}`;
Â  Â  Â  Â  Â  Â  feedbackArea.style.borderLeft = "5px solid var(--correct)";
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  btnElement.classList.add("wrong");
Â  Â  Â  Â  Â  Â  buttons[currentData.correct].classList.add("correct");
Â  Â  Â  Â  Â  Â  feedbackArea.innerHTML = `<strong>Incorrect.</strong> La bonne rÃ©ponse Ã©tait : <em>${currentData.options[currentData.correct]}</em><br>${currentData.explanation}`;
Â  Â  Â  Â  Â  Â  feedbackArea.style.borderLeft = "5px solid var(--wrong)";
Â  Â  Â  Â  }

Â  Â  Â  Â  feedbackArea.style.display = "block";
Â  Â  Â  Â  nextBtn.style.display = "block";
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (currentQuestionIndex === quizData.length - 1) {
Â  Â  Â  Â  Â  Â  nextBtn.textContent = "Voir les rÃ©sultats";
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function nextQuestion() {
Â  Â  Â  Â  currentQuestionIndex++;
Â  Â  Â  Â  if (currentQuestionIndex < quizData.length) {
Â  Â  Â  Â  Â  Â  loadQuestion();
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  showResults();
Â  Â  Â  Â  }
Â  Â  }


Â  Â  /**
Â  Â  Â * Affiche les rÃ©sultats, calcule le temps et l'Index de Performance
Â  Â  Â */
Â  Â  function showResults() {
Â  Â  Â  Â  clearInterval(chronoInterval); // ArrÃªter le chronomÃ¨tre
Â  Â  Â  Â  quizArea.style.display = "none";
Â  Â  Â  Â  resultsArea.style.display = "block";
Â  Â  Â  Â Â 
Â  Â  Â  Â  // On masque l'affichage des rÃ©sultats finaux en attendant que le pseudo soit renseignÃ©
Â  Â  Â  Â  document.getElementById("final-results-display").style.display = "none";
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- 1. Calcul du temps Ã©coulÃ© ---
Â  Â  Â  Â  const minutes = Math.floor(timeTakenSeconds / 60);
Â  Â  Â  Â  const seconds = timeTakenSeconds % 60;
Â  Â  Â  Â  const timeDisplay = `${minutes} min ${seconds} sec`;

Â  Â  Â  Â  // --- 2. Calcul du Score PondÃ©rÃ© (Index de Performance) ---
Â  Â  Â  Â  const rawPercentage = (score / MAX_SCORE) * 100;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const TARGET_TIME_SECONDS = 120; // Temps cible: 2 minutes (120 secondes)
Â  Â  Â  Â Â 
Â  Â  Â  Â  let timeFactor = 1;
Â  Â  Â  Â  if (timeTakenSeconds > TARGET_TIME_SECONDS) {
Â  Â  Â  Â  Â  Â  // Malus : 0.1% de malus par seconde au-delÃ  du temps cible
Â  Â  Â  Â  Â  Â  timeFactor = 1 - ((timeTakenSeconds - TARGET_TIME_SECONDS) * 0.001);
Â  Â  Â  Â  Â  Â  timeFactor = Math.max(0.5, timeFactor); // Limite du malus Ã  50%
Â  Â  Â  Â  }

Â  Â  Â  Â  // On stocke le rÃ©sultat dans la variable globale pour l'envoi
Â  Â  Â  Â  performanceIndex = Math.round(rawPercentage * timeFactor);
Â  Â  Â  Â  performanceIndex = Math.max(0, Math.min(100, performanceIndex));


Â  Â  Â  Â  // --- 3. Mise Ã  jour des valeurs de l'Ã©cran de rÃ©sultats ---
Â  Â  Â  Â  document.getElementById("final-score-val").textContent = performanceIndex + "%";Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Afficher le score brut (X/30)
Â  Â  Â  Â  document.getElementById("raw-score-display").textContent = `Score brut : ${score} / ${MAX_SCORE} Points`;

Â  Â  Â  Â  document.getElementById("time-taken-display").textContent = `DurÃ©e totale : ${timeDisplay}`;


Â  Â  Â  Â  const msg = document.getElementById("final-message");
Â  Â  Â  Â  if (performanceIndex === 100) {
Â  Â  Â  Â  Â  Â  msg.textContent = "FÃ©licitations ! Vous Ãªtes un MaÃ®tre du Rhum avec une rapiditÃ© impressionnante ! ğŸ¥ƒ";
Â  Â  Â  Â  } else if (performanceIndex >= 75) {
Â  Â  Â  Â  Â  Â  msg.textContent = "Index de Performance Excellent ! Votre connaissance et votre rapiditÃ© sont au top.";
Â  Â  Â  Â  } else if (performanceIndex >= 35) {
Â  Â  Â  Â  Â  Â  msg.textContent = "Index Correct. Vous avez de bonnes bases, mais tentez d'Ãªtre plus rapide la prochaine fois !";
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  msg.textContent = "C'est un dÃ©but. AccÃ©lÃ©rez le rythme !";
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Initialiser le statut d'envoi
Â  Â  Â  Â  document.getElementById('send-status').textContent = "Statut : PrÃªt Ã  envoyer.";
Â  Â  }
Â  Â Â 
Â  Â  // -------------------------------------------------------------------
Â  Â  // FONCTION POUR ENVOYER LES RÃ‰SULTATS (Avec Exponential Backoff)
Â  Â  // -------------------------------------------------------------------
Â  Â  async function sendResult(pseudo) {
Â  Â  Â  Â  if (resultSent) return;Â 

Â  Â  Â  Â  document.getElementById('send-status').textContent = "Envoi des rÃ©sultats en cours...";
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Afficher d'abord les rÃ©sultats calculÃ©s si ce n'est pas fait
Â  Â  Â  Â  document.getElementById("final-results-display").style.display = "block";

Â  Â  Â  Â  const dataToSend = {
Â  Â  Â  Â  Â  Â  pseudo: pseudo,
Â  Â  Â  Â  Â  Â  score: score,Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  time: timeTakenSeconds,Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  performanceIndex: performanceIndexÂ 
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));
Â  Â  Â  Â  const maxRetries = 3;
Â  Â  Â  Â  let attempt = 0;
Â  Â  Â  Â  let success = false;

Â  Â  Â  Â  while (attempt < maxRetries && !success) {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Tentative d'envoi Ã  Google Apps Script
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(GAS_URL, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mode: 'no-cors', // NÃ©cessaire pour les appels cross-origin simples
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cache: 'no-cache',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(dataToSend)
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  // Si le fetch rÃ©ussit sans erreur rÃ©seau (mÃªme si la rÃ©ponse est opaque), on considÃ¨re que l'envoi a Ã©tÃ© tentÃ©.
Â  Â  Â  Â  Â  Â  Â  Â  success = true;
Â  Â  Â  Â  Â  Â  Â  Â  resultSent = true;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('send-status').textContent = "âœ… RÃ©sultat enregistrÃ© !";
Â  Â  Â  Â  Â  Â  Â  Â  sendResultsBtn.disabled = true; // DÃ©sactiver le bouton aprÃ¨s l'envoi

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  attempt++;
Â  Â  Â  Â  Â  Â  Â  Â  if (attempt < maxRetries) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const waitTime = Math.pow(2, attempt) * 1000;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Pas de log d'erreur ici pour l'exponential backoff (consigne)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await delay(waitTime);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Erreur lors de l'envoi des donnÃ©es Ã  Google Sheets (aprÃ¨s plusieurs tentatives):", error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('send-status').textContent = "âŒ Ã‰chec de l'enregistrement. VÃ©rifiez l'URL et les logs du script.";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resultSent = false;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // -------------------------------------------------------------------
Â  Â  // GESTION DE LA SAISIE DU PSEUDO (Afficher le bouton d'envoi)
Â  Â  // -------------------------------------------------------------------

Â  Â  function handlePseudoInput(pseudoValue) {
Â  Â  Â  Â  const pseudoTrimmed = pseudoValue.trim();
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Afficher ou masquer le bouton d'envoi en fonction de la saisie
Â  Â  Â  Â  if (pseudoTrimmed.length > 0) {
Â  Â  Â  Â  Â  Â  sendResultsBtn.style.display = "block";
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  sendResultsBtn.style.display = "none";
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Si le pseudo change APRÃˆS l'envoi initial, on permet de renvoyer (optionnel)
Â  Â  Â  Â  if (resultSent) {
Â  Â  Â  Â  Â  Â  resultSent = false;
Â  Â  Â  Â  Â  Â  document.getElementById('send-status').textContent = "Statut : PrÃªt Ã  envoyer de nouveau.";
Â  Â  Â  Â  Â  Â  sendResultsBtn.disabled = false;
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  // -------------------------------------------------------------------
Â  Â  // GESTION DU CLIC SUR LE BOUTON D'ENVOI
Â  Â  // -------------------------------------------------------------------
Â  Â Â 
Â  Â  function sendResultFromButton() {
Â  Â  Â  Â  const pseudoInput = document.getElementById('pseudo-input');
Â  Â  Â  Â  const pseudo = pseudoInput.value.trim();

Â  Â  Â  Â  if (pseudo.length > 0) {
Â  Â  Â  Â  Â  Â  sendResult(pseudo);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  document.getElementById('send-status').textContent = "Veuillez entrer un pseudo valide.";
Â  Â  Â  Â  Â  Â  pseudoInput.focus();
Â  Â  Â  Â  }
Â  Â  }
</script>

</body>
</html>
